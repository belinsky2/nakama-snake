# ==============================================================================
# üéÆ Snake Game Frontend ‚Äî Dockerfile
# ==============================================================================
# Multi-stage build: Node –¥–ª—è —Å–±–æ—Ä–∫–∏, Nginx –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏–∫–∏

# --- Stage 1: Build ---
FROM node:20-alpine as builder

WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package files
COPY package*.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN npm ci

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
COPY . .

# –ü–µ—Ä–µ–¥–∞—ë–º API URL —á–µ—Ä–µ–∑ build-time –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
ARG VITE_API_URL=http://localhost:8000/api
ENV VITE_API_URL=$VITE_API_URL

# –°–æ–±–∏—Ä–∞–µ–º production build
RUN npm run build

# --- Stage 2: Production ---
FROM nginx:alpine

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
COPY nginx.conf /etc/nginx/conf.d/default.conf

# –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
COPY --from=builder /app/dist /usr/share/nginx/html

# –ü–æ—Ä—Ç
EXPOSE 80

# Nginx –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
CMD ["nginx", "-g", "daemon off;"]
